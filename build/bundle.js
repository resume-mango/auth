(()=>{"use strict";var e={801:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(931));t.default={login:(e,t,o)=>n(void 0,void 0,void 0,(function*(){var n,r,i;try{const o=null===(n=e.query.rm_path)||void 0===n?void 0:n.toString(),a=null===(r=e.query.rm_name)||void 0===r?void 0:r.toString(),s=(null===(i=e.query.screen)||void 0===i?void 0:i.toString())||"",c=a&&o?`/auth?rm_name=${a}&rm_path=${o}`:"/auth";t.oidc.login({returnTo:c,silent:!0,authorizationParams:{screen:s}})}catch(e){o(e)}})),logout:(e,t,o)=>n(void 0,void 0,void 0,(function*(){try{if(!e.oidc.isAuthenticated())throw new i.default.Unauthorized("Not logged in");t.oidc.logout({returnTo:"https://www.careermango.co"}),t.clearCookie("rm_ia",{path:"/",domain:".careermango.co"})}catch(e){o(e)}}))}},443:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(931)),a=o(922);t.default={home:(e,t,o)=>n(void 0,void 0,void 0,(function*(){var n,r,i;try{let o,s="https://www.careermango.co";const c=null===(n=e.query.rm_path)||void 0===n?void 0:n.toString(),u=null===(r=e.query.rm_name)||void 0===r?void 0:r.toString(),d=null===(i=e.oidc.accessToken)||void 0===i?void 0:i.access_token,{SID:l}=e.cookies;l&&(yield(0,a.syncToken)(d,l)),c&&u?(o="app"===u?"https://app.careermango.co":"manage"===u?"https://manage.careermango.co":"https://app.careermango.co",s=o+c):s="https://app.careermango.co",t.redirect(s)}catch(e){o(e)}})),initialData:(e,t,o)=>n(void 0,void 0,void 0,(function*(){var n;try{const{SID:o}=e.cookies;if(!e.oidc.isAuthenticated())throw new i.default.Unauthorized;const{token_type:r,isExpired:s,refresh:c}=e.oidc.accessToken,u=e.oidc.user;if(!u)throw new i.default.Unauthorized("user not found!");const d=(0,a.parseUser)(u);let l=null===(n=e.oidc.accessToken)||void 0===n?void 0:n.access_token;if(s()){const{access_token:e}=yield c();l=e}if(!l||!r)throw new i.default.Unauthorized;if(!d.ref){const e=yield(0,a.updateUserRef)(l,c,o);e&&(l=null==e?void 0:e.access_token,d.ref=e.ref)}t.status(200),t.json({user:d,token:`${r} ${l}`})}catch(e){o(e)}})),refreshSession:(e,t,o)=>n(void 0,void 0,void 0,(function*(){try{if(!e.oidc.isAuthenticated())throw new i.default.Unauthorized;const{token_type:o,refresh:n}=e.oidc.accessToken,{access_token:r}=yield n();if(!r)throw(0,i.default)(400,"failed to refresh session!");console.log("refreshed"),t.status(200),t.json(`${o} ${r}`)}catch(e){o(e)}}))}},82:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(931));t.default={token:(e,t,o)=>n(void 0,void 0,void 0,(function*(){var n;try{if(!e.oidc.isAuthenticated())throw new i.default.Unauthorized;const{token_type:o,isExpired:r,refresh:a}=e.oidc.accessToken;let s=null===(n=e.oidc.accessToken)||void 0===n?void 0:n.access_token;if(r()){const{access_token:e}=yield a();s=e}if(!s||!o)throw new i.default.Unauthorized;t.status(200),t.json({token_type:o,token:s})}catch(e){o(e)}}))}},922:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateUserRef=t.syncToken=t.parseUser=void 0;const i=r(o(167));t.parseUser=e=>{let t="",o="";const n="https://www.careermango.co",r=e&&e[n].user_metadata,i=e&&e[n].app_metadata,a=e&&e[n].role||null;r&&r.firstName?(t=r.firstName,o=r.lastName):"auth0"===e.sub.split("|")[0]?t=e.nickname:(t=e.given_name,o=e.family_name);const s=i.ref||"";return{id:e.sub,role:a,firstName:t,lastName:o,ref:s}},t.syncToken=(e,t)=>n(void 0,void 0,void 0,(function*(){return yield i.default.request({method:"PATCH",url:"https://api.careermango.co/v1/m2m/user/sid",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,Cookie:`SID=${t};`},withCredentials:!0}).then((e=>n(void 0,void 0,void 0,(function*(){return console.log("synced"),!0})))).catch((e=>(console.log("failed to sync session ID!"),!1)))})),t.updateUserRef=(e,t,o)=>n(void 0,void 0,void 0,(function*(){return yield i.default.request({method:"POST",url:"https://api.careermango.co/v1/m2m/user",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,Cookie:`SID=${o};`},withCredentials:!0}).then((e=>n(void 0,void 0,void 0,(function*(){const{access_token:o}=yield t();return{access_token:o,ref:e.data}})))).catch((e=>(console.log(e.response&&e.response.data&&e.response.data.message?e.response.data.message:e),null)))}))},242:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.emailVerify=void 0,t.emailVerify=(e,t,o,n)=>{if(400===e.status&&e.message.includes("email_not_verified")){const t=e.message.split("email_not_verified:")[1].split(")")[0];o.redirect(`https://www.careermango.co/verify-email/${Buffer.from(t).toString("base64")}`)}else n(e)}},653:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=t.notFound=void 0;const r=o(219);t.notFound=(e,t,o)=>n(void 0,void 0,void 0,(function*(){const e=new Error("Not Found");e.status=404,o(e)})),t.errorHandler=(e,t,o,n)=>{console.log(e.stack);const{retry:i}=t.query;return i||400!==e.status||!e.message.includes("checks.state argument is missing")&&!e.message.includes("state mismatch")?401===e.status&&e.message.includes("Not logged in")?o.redirect("https://www.careermango.co"):(o.status(e.status||500),o.send({error:{status:e.status||500,message:e.message||"Something went wrong",stack:r.IN_PROD?null:e.stack}})):(console.log("redirect for check state error"),o.redirect("/auth?retry=1"))}},616:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(860)),i=n(o(443)),a=n(o(801)),s=n(o(82)),c=o(277),u=r.default.Router();u.get("/",(0,c.requiresAuth)(),i.default.home),u.get("/data",i.default.initialData),u.get("/refresh",i.default.refreshSession),u.get("/private/token",s.default.token),u.get("/login",a.default.login),u.get("/logout",a.default.logout),t.default=u},752:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},a=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=s(o(860)),u=s(o(582)),d=s(o(806)),l=s(o(985)),f=s(o(616)),h=s(o(710)),p=s(o(470)),v=s(o(945)),_=s(o(17)),m=o(34),g=o(277),y=o(653),w=o(219),x=s(o(834)),k=s(o(37)),P=o(242),O=i(o(856)),b=i(o(842)),N=(0,c.default)();O.init({dsn:"https://86c059ff324449228203ffc22fb45f4c@o4504937560211456.ingest.sentry.io/4504937864232960",integrations:[new O.Integrations.Http({tracing:!0}),new b.Integrations.Express({app:N}),...O.autoDiscoverNodePerformanceMonitoringIntegrations()],tracesSampleRate:1});const I=(0,x.default)({cookie:{key:"CSRF-TOKEN",httpOnly:!0,secure:w.IN_PROD||!1,maxAge:3600,path:"/",domain:w.IN_PROD?".careermango.co":"localhost",sameSite:"lax"}}),D=(0,v.default)(g.auth);N.set("views",_.default.join(__dirname,"/views")),N.set("view engine","ejs"),N.disable("x-powered-by"),N.use(O.Handlers.requestHandler()),N.use(O.Handlers.tracingHandler()),N.use((0,u.default)({origin:!0,credentials:!0})),N.use(c.default.json()),N.use(c.default.urlencoded({extended:!0})),N.use((0,h.default)()),N.use((0,p.default)("dev")),N.use((0,d.default)({crossOriginResourcePolicy:!1})),w.IN_STAGING||(N.set("trust proxy",["loopback","linklocal","uniquelocal"]),N.use(I),N.use(((e,t,o)=>{const n=e.csrfToken();t.cookie("XSRF-TOKEN",n,{secure:w.IN_PROD||!1,maxAge:3600,path:"/",domain:w.IN_PROD?".careermango.co":"localhost",sameSite:"lax"}),t.locals.csrfToken=n,o()})));const R=(0,l.default)({windowMs:6e4,max:100});N.use(R);const S={clientSecret:"PgSgMsCkB_7J93aroMdpLmTNFdKU4WLy1WcG7cS_9p46GBYNRzr4ikdLRXL_CYn9",clientID:"9saEJsETL1TYA9oMSRAI1hvLfUFtraZE",secret:"c5d20c60053920d1b36c467811c32a063a91153698ed3a560c18729a27b490fb",issuerBaseURL:"https://resumemango.us.auth0.com",baseURL:"https://auth.careermango.co",authRequired:!1,auth0Logout:!0,idpLogout:!0,authorizationParams:{response_type:"code",audience:"user-identifier",scope:"openid profile email offline_access"},routes:{login:!1,logout:!1,callback:"/auth/callback"},session:{name:"SID",store:new D({client:m.redisClient}),cookie:{domain:w.IN_PROD?".careermango.co":"localhost",path:"/",transient:!1,httpOnly:!0,secure:w.IN_PROD,sameSite:"Lax"}},afterCallback:(e,t,o)=>a(void 0,void 0,void 0,(function*(){return t.cookie("rm_ia",!0,{expires:new Date(1e3*parseInt(o.expires_at)),path:"/",domain:w.IN_PROD?".careermango.co":"localhost",sameSite:"lax",secure:w.IN_PROD}),o}))};N.use((0,g.auth)(S)),N.use("/auth",f.default),N.use("/auth/health-check",((e,t)=>{const o={uptime:process.uptime(),processtime:process.hrtime(),message:"OK",timestamp:Date.now(),id:k.default.hostname()};try{t.send(o)}catch(e){o.message=e,t.status(503).send()}})),N.use(P.emailVerify,y.notFound,O.Handlers.errorHandler(),y.errorHandler),process.on("uncaughtException",(function(e){console.error(e),console.log("Node NOT Exiting...")})),t.default=N},219:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IN_STAGING=t.IN_PROD=t.APP_ORIGIN=t.PORT=void 0;const o="4001";t.PORT=o;const n=`http://localhost:${o}`;t.APP_ORIGIN=n,t.IN_PROD=!0,t.IN_STAGING=!1},34:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.redisClient=void 0;const r=n(o(22)),i=n(o(495)),a=o(219).IN_PROD?"rm-cache.stmhwq.0001.use2.cache.amazonaws.com":"localhost",s={port:Number("6379"),host:a},c=new i.default(s);t.redisClient=c,c.on("connect",(()=>console.log(r.default.yellow.bold(`Redis connected on ${a}:${Number("6379")}`)))),c.on("error",(()=>console.log(r.default.red.bold(`Redis failed to connect on ${a}:${Number("6379")}`))))},728:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.viteNodeApp=void 0;const i=r(o(22)),a=r(o(752)),s=o(219);t.viteNodeApp=n(void 0,void 0,void 0,(function*(){try{a.default.listen(s.PORT,(()=>console.log(i.default.blue.bold(`Server running on ${s.APP_ORIGIN}`))))}catch(e){console.error(i.default.red.bold(e,"trigger"))}}))},856:e=>{e.exports=require("@sentry/node")},842:e=>{e.exports=require("@sentry/tracing")},167:e=>{e.exports=require("axios")},22:e=>{e.exports=require("chalk")},945:e=>{e.exports=require("connect-redis")},710:e=>{e.exports=require("cookie-parser")},582:e=>{e.exports=require("cors")},834:e=>{e.exports=require("csurf")},860:e=>{e.exports=require("express")},277:e=>{e.exports=require("express-openid-connect")},985:e=>{e.exports=require("express-rate-limit")},806:e=>{e.exports=require("helmet")},931:e=>{e.exports=require("http-errors")},495:e=>{e.exports=require("ioredis")},470:e=>{e.exports=require("morgan")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")}},t={};!function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(728)})();
//# sourceMappingURL=bundle.js.map